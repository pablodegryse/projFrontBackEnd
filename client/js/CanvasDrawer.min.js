var CanvasDrawer=function(){function n(n){C.x=n.oldPos.x,C.y=n.oldPos.y,w.x=n.currentPos.x,w.y=n.currentPos.y}function e(n){h=n,d.strokeStyle=h}function t(){d.beginPath(),d.clearRect(0,0,s.width,s.height)}function i(){if(y&&w.x>0&&w.y>0&&x){var n=(new Date).getTime();v=n,g=v-m,g>25&&(f.emit("drawUpdate",{oldPos:C,currentPos:w}),d.lineTo(w.x,w.y),d.moveTo(w.x,w.y),d.stroke(),m=v)}}function o(){d.lineTo(w.x,w.y),d.moveTo(w.x,w.y),d.stroke()}function a(n,e){w.x=n,w.y=e}function c(n,e){C.x=n,C.y=e}function r(n,e){f=e,s=n,d=s.getContext("2d"),l=s.getBoundingClientRect()}function u(n){document.addEventListener("mousemove",function(n){y&&(a(n.clientX-l.left-4,n.clientY-l.top-4),i(),c(w.x,w.y))}),s.addEventListener("mousedown",function(){if(y){var n=(new Date).getTime();m=n,x=!0,d.beginPath(),f.emit("drawBegin","true")}}),s.addEventListener("mouseup",function(){y&&(x=!1,f.emit("drawEnd","true"))});for(var o=n.getElementsByClassName("canvasColor"),r=0,u=o.length;r<u;r++)o[r].addEventListener("click",function(n){y&&(e(n.target.name),f.emit("changedColor",h))});var v=n.getElementsByClassName("canvasClearBtn")[0];v.addEventListener("click",function(){y&&(t(),f.emit("canvasClear"))})}var s,d,l,f,m,v,g,y=!1,h="Red",x=!1,C={x:0,y:0},w={x:0,y:0};return{init:function(n,e,t){r(n,t),u(e),d.lineWidth="4",d.lineCap="round",d.lineJoin="miter"},drawToCanvas:function(e){n(e),o()},setmouseDown:function(){x=!0,d.beginPath()},setMouseUp:function(){x=!1},changeColor:function(n){e(n)},clearCanvas:function(){t()},changeDrawPermission:function(n){y=n,d.beginPath(),d.clearRect(0,0,s.width,s.height)}}}();